syntax = "proto3";

package generated;

option go_package = "github.com/kuzin57/grpc-chat/server/internal/generated";

service Messenger {
    rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);
    rpc GetMessages(GetMessagesRequest) returns (GetMessagesResponse);
    rpc GetUserChats(GetUserChatsRequest) returns (GetUserChatsResponse);
    rpc CreateChat(CreateChatRequest) returns (CreateChatResponse);
    rpc LeaveChat(LeaveChatRequest) returns (LeaveChatResponse);
    rpc JoinChat(JoinChatRequest) returns (JoinChatResponse);
    rpc SetMessagesRead(SetMessagesReadRequest) returns (SetMessagesReadResponse);
    
    rpc ChatStream(stream ChatMessage) returns (stream ChatMessage);
}

message SendMessageRequest {
    string message = 1;
    string chat_id = 2;
    string nickname = 3;
}

message SendMessageResponse {
    string message_id = 1;
}

message GetMessagesRequest {
    string chat_id = 1;
}

message GetMessagesResponse {
    repeated Message messages = 1;
}

message Message {
    string id = 1;
    string content = 2;
    string chat_id = 3;
    string nickname = 4;
    string created_at = 5;
}

message ChatMessage {
    string id = 1;
    string content = 2;
    string chat_id = 3;
    string created_at = 5;
    ChatMessageType type = 6;
}

message GetUserChatsRequest {
    string nickname = 1;
}

message GetUserChatsResponse {
    repeated ChatStats chats = 2;
}

message ChatStats {
    string chat_id = 1;
    int32 new_messages = 2;
}

message CreateChatRequest {
    string name = 1;
    string nickname = 2;
}

message CreateChatResponse {
    string chat_id = 1;
}

message LeaveChatRequest {
    string chat_id = 1;
    string nickname = 2;
}

message LeaveChatResponse {
    bool success = 1;
}

message JoinChatRequest {
    string chat_id = 1;
    string nickname = 2;
}

message JoinChatResponse {
    bool success = 1;
}

enum ChatMessageType {
    MESSAGE = 0;
    USER_JOINED = 1;
    USER_LEFT = 2;
}

message SetMessagesReadRequest {
    string chat_id = 1;
    string nickname = 2;
}

message SetMessagesReadResponse {
    bool success = 1;
}